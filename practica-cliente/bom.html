<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manipulación del BOM</title>
    <link rel="stylesheet" href="css/estilos.css">
</head>
<body>
    <h2> Manipulación del BOM</h2>
    <br
    <div id ="botones">
        <button id="abrir" onclick="abrirventana()">Abrir ventana</button>
        <button id="cerrar" onclick="cerrarVentana()">Cerrar ventana</button>
        <button id="moverVentana" onclick="moverVentana()">Mover ventana</button>
        <button id="cambiarUrl" onclick="cambiarUrl()">Cambiar URL Ventana</button>
        <label for="temporizador">Temporizador</label> <input type="checkbox" id="temporizador" >
    </div>
    <footer>
        <a href="#" onclick="window.href=window.history.back();" >Volver</a>

</body>
</html>
<script>
    var ventana;
    var temporizador=false;
    document.getElementById('temporizador').addEventListener('change',function(){
        if(this.checked){
       temporizador = true;
        }else{
            temporizador = false;}
            console.log('El temporizado está '+temporizador);
    });
    /*
    @description: Abrir una ventana. Si el checkbox temporizador está seleccionado, lo hará con un delay de 3 segundos*/
    function abrirventana(){
        console.log('abrir ventana');
cambiarDisponibilidadExcepto('abrir',false);
        if (temporizador){
            window.setTimeout(function(){
                ventana = window.open("","_blank","width=400,height=400");
            },3000);
    }else{
        ventana = window.open("","_blank","width=400,height=400");
    }
    //cuando la ventana se cierre, habilita todos los botones
    ventana.addEventListener('close',function(){
        cambiarDisponibilidadExcepto('abrir',true);
    });
    }
    
    /*
   @description: Cierra la ventana inmediatamente o en 3 segundos, si el checktemporizador está seleccionado */
    function cerrarVentana(){
        
        try{
            console.log('cerrar ventana' + ventana);
      
        if (temporizador){
            window.setTimeout(function(){
                ventana.close();
            },3000);
    }   else{
        ventana.close();
    }
    cambiarDisponibilidadExcepto('abrir',true);
}catch(e){
    alert('Ha ocurrido un error al cerrar la ventana' + e);
    }
}
    /*
    @description: Mueve la ventana.
    Lo hará inmediatamente o con un pequeño delay si el temporizador está seleccionado o no*/
    function moverVentana(){
        console.log('mover ventana');
        if (temporizador){
            window.setTimeout(function(){
                ventana.moveBy(100,100);
            },500);
    }else{
        ventana.moveBy(100,100);
    }
    }
    /*usando BOM cambia la url de la ventana abierta*/
    function cambiarUrl(){
        console.log('cambiar url');
        const listadoUrls = [
            'https://www.google.com',
            'https://www.youtube.com',
            'https://www.facebook.com',
            'https://www.twitter.com',
            'https://www.instagram.com'
        ];
        let random = Math.floor(Math.random()*listadoUrls.length);
        console.log(listadoUrls[random]);
        if (temporizador){
            window.setTimeout(function(){
                ventana.location.href=listadoUrls[random];
            },3000);}else{
                ventana.location.href=listadoUrls[random];
            }
        }
        //habilita o deshabilita todos los botones excepto el que se pasa como parámetro
        function cambiarDisponibilidadExcepto(exception, habilitar){
            var botones = document.querySelectorAll('button');
            for (var i=0; i<botones.length; i++){
                if (botones[i].id != exception){
                    botones[i].disabled = habilitar;
                }else{
                    botones[i].disabled = !habilitar;
                }
            }
        }
        cambiarDisponibilidadExcepto('abrir',true);
</script>