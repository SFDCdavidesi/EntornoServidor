<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/estilos.css">

    <script src="./json/carnetsconducir.js"></script>
    <script>
        $(document).ready(function(){
            $("h1").animate({fontSize: "3em"}, 2000);
            $("form").slideUp(2000).slideDown(2000);
            //document ready se ejecuta cuando la página ha cargado completamente
            $.each(carnets, function(index, value){
                $("#carnet").append("<option value='"+value.tipo+"'>"+value.tipo+"</option>"); 
                //recorremos el array de carnets y añadimos cada uno al select
            });
            $("#carnet").animate({fontSize: "2em"}, 2000);
            //animamos el tamaño de la fuente del select carnet
            
            $.each(marcas, function(index, value){
                $("#marca").append("<option value='"+value.marca+"'>"+value.marca+"</option>"); 
                //recorremos el array de marcas, obtenido a través del fichero json y añadimos cada uno al select
            });
   
            $("#marca").change(function(){
           
                //cada vez que cambie el valor del select de marca, se ejecutará esta función
                $("#modelo").empty(); //vaciamos el select de modelos
                $.each(marcas, function(index, value){
                    if(value.marca==$("#marca").val()){
                        $.each(value.modelos, function(index, value){
                            //recorremos el array de modelos de la marca seleccionada y los añadimos al select
                            $("#modelo").append("<option value='"+value+"'>"+value+"</option>"); 
                        });
                    }
                });
            
            });
            $("#marca").val("Audi").change(); //seleccionamos la marca Audi y ejecutamos el evento change
            $("form").submit(function(event){
                //cuando se envíe el formulario
                $("#spinner").show(); //mostramos el spinner
                event.preventDefault(); //evitamos que se envíe el formulario
                 // Obtener los datos del formulario
             var formData = $(this).serialize();
                console.log(formData);
                $.ajax({
                    type: "POST",
                    url: "vehiculos.php",
                    data: formData,                   
                    success: function(response){ //si la petición se ha realizado correctamente
                        console.log(response);
                        $("#spinner").hide();
                    },
                    error: function(xhr, status, error){
                          console.error(xhr.responseText); // Imprimir mensaje de error en la consola
            }
                });
            });
            $("button").click(function(){
        
                $("#spinner").show();

                //cuando se haga clic en el botón
                $.ajax({
                    type: "GET",
                    url: "vehiculos.php",
                    success: function(response){ //si la petición se ha realizado correctamente
                      // Después de 3 segundos, ocultar el spinner

    $("#spinner").hide();

                        const vehiculos = JSON.parse(response); //parseamos la respuesta a JSON
                        $("#resultadosBusqueda").empty(); //vaciamos el div resultadosBusqueda
                      
                        for (let vehiculo of vehiculos) {
                            //recorremos el array de vehículos y mostramos cada registro en el div resultadosBusqueda
                           console.log('vehículo->' + vehiculo);
                            let nombre=vehiculo[0]; //obtenemos el nombre del vehículo

                            let apellidos=vehiculo[1];
                            let email=vehiculo[2];
                            let fecha_de_nacimiento=vehiculo[3];
                            let carnet=vehiculo[4];
                            let marca=vehiculo[5];
                            let modelo=vehiculo[6];
                            let acabado=vehiculo[7];
                            console.debug("nombre : " + nombre);
                            $("#resultadosBusqueda").append("<p>Nombre: " + nombre + "</p>").show (2000);
                            $("#resultadosBusqueda").append("<p>Apellidos: " + apellidos + "</p>");
                            $("#resultadosBusqueda").append("<p>Email: " + email + "</p>");
                            $("#resultadosBusqueda").append("<p>Fecha de Nacimiento: " + fecha_de_nacimiento + "</p>");
                            $("#resultadosBusqueda").append("<p>Carnet de conducir: " + carnet + "</p>");
                            $("#resultadosBusqueda").append("<p>Marca: " + marca + "</p>");
                            $("#resultadosBusqueda").append("<p>Modelo: " + modelo + "</p>");
                            $("#resultadosBusqueda").append("<p>Acabado: " + acabado + "</p>");
                            $("#resultadosBusqueda").append("<hr>").fadeIn(2000);
                        }

                       
                    },
                    error: function(xhr, status, error){
                          console.error(xhr.responseText); // Imprimir mensaje de error en la consola
            }
                });
            });
        });
        
        
    </script>
</head>
<body>
    <h1> Uso de Jquery</h1>
    <div id="spinner" class="spinner-border text-primary" style="display:none;">
        <span class="sr-only">Loading...</span>
      </div>
      
    <form>

    <table>
        <tr>
            <td>Nombre:</td>
            <td><input type="text" name="nombre" required minlength="2"></td>
        </tr>
        <tr>
            <td>Apellidos:</td>
            <td><input type="text" name="apellidos" required minlength="3"></td>
        </tr>
        <tr>
            <td>Email:</td>
            <td><input type="email" name="email" required></td>
        </tr>
        <tr>
            <td>Fecha de nacimiento:</td>
            <td><input type="date" name="fecha_de_nacimiento"></td>
        </tr>
        <tr>
            <td>Carnet de conducir:</td>
            <td><select id="carnet" name="carnet"></select></td>
        </tr>
        <tr>
            <td>Marca vehículo:</td>
            <td><select id="marca" name="marca"></select>></td>
        </tr>
        <tr>
            <td>Modelo:</td>
            <td><select id="modelo" name="modelo"></select>></td>
        </tr>
        <tr>
            <td>Acabado:</td>
            <td><input type="text" name="acabado"></td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="Enviar">
            </td>
        </tr>
    </table>
</form>
        <hr>
        <h2>Buscar registros de usuario</h2>
        <button> Mostrar todos los registros guardados</button>
       <div id="resultadosBusqueda"></div>
        <footer>
            <a href="#" onclick="window.href=window.history.back();" >Volver</a>
        </footer>
</body>
</html>